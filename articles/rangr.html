<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rangr">
<title>How to use rangr? • rangr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to use rangr?">
<meta property="og:description" content="rangr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rangr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/rangr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/popecol/rangr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to use rangr?</h1>
                        <h4 data-toc-skip class="author">Katarzyna
Markowska</h4>
            
            <h4 data-toc-skip class="date">26-05-2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/popecol/rangr/blob/HEAD/vignettes/rangr.Rmd" class="external-link"><code>vignettes/rangr.Rmd</code></a></small>
      <div class="d-none name"><code>rangr.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="about-rangr">About <code>rangr</code><a class="anchor" aria-label="anchor" href="#about-rangr"></a>
</h2>
<p>This vignette shows an example of a basic use of the
<code>rangr</code> package. The main goal of this tool is to simulate
species range dynamics. The simulations can be performed in a spatially
explicit and dynamic environment, allowing for projections of how
populations will respond to e.g. climate or land use changes.
Additionally, by implementing various sampling methods and observational
error distributions, it can accurately reflect the structure of original
survey data or simulate random sampling.</p>
<p>Here, we showcase the full capabilities of our package, from creating
a virtual species to performing simulation and visualization of
results.</p>
</div>
<div class="section level2">
<h2 id="basic-workflow">Basic workflow<a class="anchor" aria-label="anchor" href="#basic-workflow"></a>
</h2>
<p>In this chapter we will show you how to perform basic simulation
using maps provided with the package.</p>
<div class="section level3">
<h3 id="installing-the-package">Installing the package<a class="anchor" aria-label="anchor" href="#installing-the-package"></a>
</h3>
<p>First we need to install and load the <code>rangr</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("rangr")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/popecol/rangr" class="external-link">rangr</a></span><span class="op">)</span></span></code></pre></div>
<p>Since the maps in which the simulation takes place have to be in the
<code>SpatRaster</code> format, we will also install and load the
<code>terra</code> package to facilitate their manipulation and
visualisation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("terra")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="input-maps">Input maps<a class="anchor" aria-label="anchor" href="#input-maps"></a>
</h3>
<p>One of the most important input parameters for simulation are maps
specifying the abundance of the virtual species at the starting point of
the simulation and carrying capacity of environment in which simulation
takes place. In this section, we will not generate them from scratch.
Instead, we will use maps provided with the package.</p>
<p>Example maps available in rangr:</p>
<ul>
<li><code>n1_small.tif</code></li>
<li><code>n1_big.tif</code></li>
<li><code>K_small.tif</code></li>
<li><code>K_small_changing.tif</code></li>
<li><code>K_big.tif</code></li>
</ul>
<p>You can find additional information about these data sets in help
files:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">n1_small.tif</span></span>
<span><span class="op">?</span><span class="va">K_small.tif</span></span></code></pre></div>
<p>We will use these two datasets right now:</p>
<ul>
<li><p><code>n1_small.tif</code> - as abundance at the starting
point,</p></li>
<li><p><code>K_small.tif</code> - as carrying capacity.</p></li>
</ul>
<p>To read the data we can use <code>rast</code> function from the
<code>terra</code> package:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n1_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input_maps/n1_small.tif"</span>, package <span class="op">=</span> <span class="st">"rangr"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">K_small</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input_maps/K_small.tif"</span>, package <span class="op">=</span> <span class="st">"rangr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Since both of these maps refer to the same virtual or in this case
real environment (a small region located in northwestern Poland), they
must have the same dimensions, resolution, geographical projection etc.
The only differences between them may be the values they contain and the
number of layers. You can use multiple layers in the carrying capacity
map to create a dynamic environment during the simulation, but in this
example, we will demonstrate a static environment.</p>
<p>Let’s take a closer look at them:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n1_small</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source      : n1_small.tif </span></span>
<span><span class="co">#&gt; name        : layer </span></span>
<span><span class="co">#&gt; min value   :     0 </span></span>
<span><span class="co">#&gt; max value   :    10</span></span>
<span><span class="va">K_small</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source      : K_small.tif </span></span>
<span><span class="co">#&gt; name        : layer </span></span>
<span><span class="co">#&gt; min value   :     0 </span></span>
<span><span class="co">#&gt; max value   :   100</span></span></code></pre></div>
<p>Above, you can see the dimensions and other basic characteristics of
the sample maps. The only field that differs between these maps is the
value field.</p>
<p>Now we will use the <code>plot</code> function to visualise input
maps to get an even better idea of what we’re working with.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n1_small</span>, <span class="va">K_small</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rangr_files/figure-html/unnamed-chunk-1-1.png" alt="Input maps" width="70%"><p class="caption">
Input maps
</p>
</div>
<p>Several things are noticeable here:</p>
<ol style="list-style-type: decimal">
<li><p>The shape is the same for both maps, and in both cases, the upper
left corner of the map is excluded from the simulation area and is
treated as if it were outside the map’s extent. To create such an
irregular shape, <code>NA</code> must be assigned to a particular cell
or group of cells.</p></li>
<li><p>The initial population is only located in the lower right corner
of the simulation area and occupies two cells. Each of them contains 10
individuals (you can use the <code><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values()</a></code> function to
check).</p></li>
<li><p>The carrying capacity map has areas that are unsuitable for the
presented virtual species, as well as areas where it can have a positive
population growth rate.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="initialise">Initialise<a class="anchor" aria-label="anchor" href="#initialise"></a>
</h3>
<p>Now that we have input maps, we will use the
<code><a href="../reference/initialise.html">initialise()</a></code> function to set other input parameters and
generate a <code>sim_data</code> object that will contain all the
necessary information to perform a simulation.</p>
<p>The most basic <code><a href="../reference/initialise.html">initialise()</a></code> call will look as
follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialise.html">initialise</a></span><span class="op">(</span></span>
<span>  n1_map <span class="op">=</span> <span class="va">n1_small</span>,</span>
<span>  K_map <span class="op">=</span> <span class="va">K_small</span>,</span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  rate <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">1e3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s break down this command:</p>
<ul>
<li><p><code>n1_map</code> and <code>K_map</code> refer to the input
maps described earlier.</p></li>
<li><p>The <code>r</code> parameter is used to set the intrinsic
population growth rate. The default population growth function is the
Gompetz function.</p></li>
<li><p>The <code>rate</code> parameter is related to the
<code>kernel_fun</code> parameter, which by default is set as an
exponential function (<code>rexp</code>). Therefore, <code>rate</code>
determines the shape of the dispersal function.</p></li>
</ul>
<p>That way we have determined simulation environment along with
demographic processes and dispersal. That’s the most basic set-up needed
to perform your first simulation and we will do just that in the next
step.</p>
<p>But before that, let’s see what other information
<code>sim_data</code> contains and what happened behind the scene during
initialisation.</p>
<p>First, let’s check the class of <code>sim_data</code> object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sim_data_01</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sim_data" "list"</span></span></code></pre></div>
<p>As you can see <code>sim_data</code> is a <code>sim_data</code>
object that inherits from <code>list</code> objects so it is possible to
change values of this object by hand. However, we strongly encourage you
to use <code><a href="https://rdrr.io/pkg/terra/man/update.html" class="external-link">update()</a></code> function instead to avoid errors and
problems with data integration.</p>
<p>To take a closer look at <code>sim_data</code> you can also use
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> or <code><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_data_01</span><span class="op">)</span></span>
<span><span class="co">#&gt; Summary of sim_data object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; n1 map summary: </span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;  0.0000  0.0000  0.0000  0.1449  0.0000 10.0000      12 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Carrying capacity map summary: </span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;    0.00    0.00   56.00   44.84   72.00  100.00      12 </span></span>
<span><span class="co">#&gt;                               </span></span>
<span><span class="co">#&gt; growth                gompertz</span></span>
<span><span class="co">#&gt; r            0.693147180559945</span></span>
<span><span class="co">#&gt; A                            -</span></span>
<span><span class="co">#&gt; kernel_fun                rexp</span></span>
<span><span class="co">#&gt; dens_dep                   K2N</span></span>
<span><span class="co">#&gt; border               absorbing</span></span>
<span><span class="co">#&gt; max_dist                  2000</span></span>
<span><span class="co">#&gt; changing_env             FALSE</span></span>
<span><span class="co">#&gt; dlist                     TRUE</span></span></code></pre></div>
<p>It will show the summary of both input maps, as well as list of other
most important parameters such as <code>r</code> that we set up
earlier.</p>
</div>
<div class="section level3">
<h3 id="simulation">Simulation<a class="anchor" aria-label="anchor" href="#simulation"></a>
</h3>
<p>All you need to perform a simulation is a <code>sim_data</code>
object and a specified number of time steps that you want to simulate.
Additionally, you can use the <code>burn</code> parameter to discard a
selected number of initial time steps if it makes sense for your
research or experiment.</p>
<p>In this first example, we will only set the <code>time</code>
parameter since we want to observe how our virtual species is dispersing
and reproducing.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_result_01</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.html">sim</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">sim_data_01</span>, time <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Again we will check the class of returned object:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sim_result_01</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sim_results" "list"</span></span></code></pre></div>
<p>Similar to <code>initialise</code>, <code>sim</code> also returns an
object that inherits from <code>list</code>, but in this case it is
called <code>sim_results</code>. This list has 3 elements such as:</p>
<ul>
<li><p><code>extinction</code> - <code>TRUE</code> if population is
extinct or <code>FALSE</code> otherwise</p></li>
<li><p><code>simulated_time</code> - number of simulated time steps
without the burn-in ones</p></li>
<li><p><code>N_map</code> - 3-dimensional array representing
spatiotemporal variability in population numbers. The first two
dimensions correspond to the spatial aspect of the output and the third
dimension represents time.</p></li>
</ul>
<p>The best way to take a closer look at the results is to call a
summary function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_result_01</span><span class="op">)</span></span></code></pre></div>
<p><img src="rangr_files/figure-html/summary_sim_result_01-1.png" width="70%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; Summary of sim_results object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation summary: </span></span>
<span><span class="co">#&gt;                     </span></span>
<span><span class="co">#&gt; simulated time   100</span></span>
<span><span class="co">#&gt; extinction     FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Abundances summary: </span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;    0.00    0.00   12.00   10.45   19.00   54.00    1200</span></span></code></pre>
<p>It gives you a quick and easy overview of the simulation results by
providing simulation time, extinction status and summary of all maps
with abundances. It also produces a plot that can be useful to determine
the value for <code>burn</code> parameter.</p>
</div>
<div class="section level3">
<h3 id="visualisation">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation"></a>
</h3>
<p>With <code>rangr</code> we provided an easy way to visualise chosen
time steps from the simulation. To do so you can use the generic plot
function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_result_01</span>,</span>
<span>  time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  template <span class="op">=</span> <span class="va">sim_data_01</span><span class="op">$</span><span class="va">K_map</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rangr_files/figure-html/unnamed-chunk-2-1.png" alt="Abundances" width="70%"><p class="caption">
Abundances
</p>
</div>
<pre><code><span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 4  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       : t_1, t_10, t_25, t_50 </span></span>
<span><span class="co">#&gt; min values  :   0,    0,    0,    0 </span></span>
<span><span class="co">#&gt; max values  :  10,   19,   27,   36</span></span></code></pre>
<p>You can also adjust its parameters to get more breaks on the
colorscale:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_result_01</span>,</span>
<span>  time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sim_result_01</span><span class="op">$</span><span class="va">N_map</span> <span class="op">+</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  template <span class="op">=</span> <span class="va">sim_data_01</span><span class="op">$</span><span class="va">K_map</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rangr_files/figure-html/unnamed-chunk-3-1.png" alt="Abundances" width="70%"><p class="caption">
Abundances
</p>
</div>
<pre><code><span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 4  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       : t_1, t_10, t_25, t_50 </span></span>
<span><span class="co">#&gt; min values  :   0,    0,    0,    0 </span></span>
<span><span class="co">#&gt; max values  :  10,   19,   27,   36</span></span></code></pre>
<p>If you prefer working on raster you can also transform any
<code>sim_result</code> object into <code>SpatRaster</code> using
<code><a href="../reference/to_rast.html">to_rast()</a></code> function:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># raster construction</span></span>
<span><span class="va">my_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_rast.html">to_rast</a></span><span class="op">(</span></span>
<span>  <span class="va">sim_result_01</span>,</span>
<span>  time_points <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">sim_result_01</span><span class="op">$</span><span class="va">simulated_time</span>,</span>
<span>  template <span class="op">=</span> <span class="va">sim_data_01</span><span class="op">$</span><span class="va">K_map</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print raster</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">my_rast</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 100  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       : t_1, t_2, t_3, t_4, t_5, t_6, ... </span></span>
<span><span class="co">#&gt; min values  :   0,   0,   0,   0,   0,   0, ... </span></span>
<span><span class="co">#&gt; max values  :  10,  11,  14,  16,  20,  13, ...</span></span></code></pre></div>
<p>And then visualise it using <code><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot()</a></code> function:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot selected time points</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my_rast</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rangr_files/figure-html/unnamed-chunk-5-1.png" alt="Abundances" width="70%"><p class="caption">
Abundances
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="more-advanced-workflow">More advanced workflow<a class="anchor" aria-label="anchor" href="#more-advanced-workflow"></a>
</h2>
<p>The previous workflow was pretty basic. Now we will present a more
advanced one and use it to show some of the other parameters
options.</p>
<div class="section level3">
<h3 id="input-maps-1">Input maps<a class="anchor" aria-label="anchor" href="#input-maps-1"></a>
</h3>
<div class="section level4">
<h4 id="abundances-at-the-first-time-step">Abundances at the first time step<a class="anchor" aria-label="anchor" href="#abundances-at-the-first-time-step"></a>
</h4>
<p>As we mentioned earlier, <code>rangr</code> has the ability to
simulate virtual species in a changing environment and in this example
we will show you how to do it. For a better illustration, we should
start from a more populated map than the previously used
<code>n1_small</code>. The easiest way to do this is to use abundances
from the last time step of the previous simulation as an input for the
current one. This can be done as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n1_small_02</span> <span class="op">&lt;-</span> <span class="va">n1_small</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">n1_small_02</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">sim_result_01</span><span class="op">$</span><span class="va">N_map</span><span class="op">[</span>, , <span class="fl">100</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="carrying-capacity">Carrying capacity<a class="anchor" aria-label="anchor" href="#carrying-capacity"></a>
</h4>
<p>To simulate changing environment we need to specify the changes that
we want. Essentially, you need to have a carrying capacity map for every
time step of the simulation. You can generate those by yourself or you
can generate maps only for a few key time steps (at least the first and
the last one) and then use <code><a href="../reference/K_get_interpolation.html">K_get_interpolation()</a></code> to
generate missing ones. Here we will choose the second option and use the
<code>K_small_changing</code> object that comes with <code>rangr</code>
for this purpose. Below you can see its summary:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">K_small_changing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input_maps/K_small_changing.tif"</span>, </span>
<span>                                     package <span class="op">=</span> <span class="st">"rangr"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">K_small_changing</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 3  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source      : K_small_changing.tif </span></span>
<span><span class="co">#&gt; names       : layer.1, layer.2, layer.3 </span></span>
<span><span class="co">#&gt; min values  :       0,       0,       0 </span></span>
<span><span class="co">#&gt; max values  :     100,     130,     170</span></span></code></pre></div>
<p>As you can see the carrying capacity increases in each map, meaning
that our environment is becoming more and more suitable for virtual
species. It is also worth noting that the first layer of
<code>K_small_changing</code> is the same as <code>K_small</code>.
Again, we can visualise all input maps using <code>plot</code>
function:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n1_small_02</span>, <span class="va">K_small_changing</span><span class="op">)</span>,</span>
<span>     range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n1_small_02</span>, <span class="va">K_small_changing</span><span class="op">)</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"K"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">K_small_changing</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rangr_files/figure-html/unnamed-chunk-6-1.png" alt="Input maps" width="70%"><p class="caption">
Input maps
</p>
</div>
<p>This raster has 3 layers so we can either perform a simulation with
only 3 time steps (which seems rather pointless) or, as mentioned, use
<code><a href="../reference/K_get_interpolation.html">K_get_interpolation()</a></code> function to generate maps for each
time step. In this example, we will perform 200 time steps so we will
need 200 maps.</p>
<p>The first and the last layers from <code>K_small_changing</code> are
corresponding to the first and last time steps and the middle one can be
assigned to any time step in between. Additionally, to give our virtual
species some time to adjust to the new parameters, first few carrying
capacity maps will be the same. To do so we will duplicate the first
layer of <code>K_small_changing</code>. Therefore, the layers and
corresponding time points will be as follows:</p>
<ul>
<li><p>1st layer of <code>K_small_changing</code> - 1st time
step,</p></li>
<li><p>duplicated 1st layer of <code>K_small_changing</code> - 20th time
step,</p></li>
<li><p>2nd layer of <code>K_small_changing</code> - 80th time
step,</p></li>
<li><p>3rd layer of <code>K_small_changing</code> - 200th time
step.</p></li>
</ul>
<p>This translates into a stable environment during 1-20 time steps,
rapidly increasing carrying capacity during 20-80 time steps and slowly
rising carrying capacity during 80-200 time steps.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># duplicate 1st layer of K_small_changing</span></span>
<span><span class="va">K_small_changing_altered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">K_small</span>, <span class="va">K_small_changing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># interpolate to generate maps for each time step</span></span>
<span><span class="va">K_small_changing_interpolated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/K_get_interpolation.html">K_get_interpolation</a></span><span class="op">(</span></span>
<span>  <span class="va">K_small_changing_altered</span>, </span>
<span>  K_time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span>, <span class="fl">80</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in K_check(K_map, K_time_points, time): Argument "time" is no specified</span></span>
<span><span class="co">#&gt; - last number from "K_time_points" is used as "time"</span></span>
<span><span class="va">K_small_changing_interpolated</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 200  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       : lyr.1, lyr.2, lyr.3, lyr.4, lyr.5, lyr.6, ... </span></span>
<span><span class="co">#&gt; min values  :     0,     0,     0,     0,     0,     0, ... </span></span>
<span><span class="co">#&gt; max values  :   100,   100,   100,   100,   100,   100, ...</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualise results</span></span>
<span><span class="va">vis_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">K_small_changing_interpolated</span>, subset <span class="op">=</span> <span class="va">vis_layers</span><span class="op">)</span>,</span>
<span>     range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/values.html" class="external-link">values</a></span><span class="op">(</span><span class="va">K_small_changing_interpolated</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"K"</span>, <span class="va">vis_layers</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rangr_files/figure-html/unnamed-chunk-7-1.png" alt="Interpolation results" width="90%"><p class="caption">
Interpolation results
</p>
</div>
<p>This completes preparation of input maps needed for this example. Now
we will select values of other parameters.</p>
</div>
</div>
<div class="section level3">
<h3 id="initialise-using-update-function">Initialise (using update function)<a class="anchor" aria-label="anchor" href="#initialise-using-update-function"></a>
</h3>
<p>First let’s look again at the <code>sim_data</code> object from the
previous chapter:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sim_data_01</span><span class="op">)</span></span>
<span><span class="co">#&gt; Class: sim_data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; n1_map:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;  0.0000  0.0000  0.0000  0.1449  0.0000 10.0000      12 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; K_map:</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; name        : layer </span></span>
<span><span class="co">#&gt; min value   :     0 </span></span>
<span><span class="co">#&gt; max value   :   100 </span></span>
<span><span class="co">#&gt;                             </span></span>
<span><span class="co">#&gt; resolution              1000</span></span>
<span><span class="co">#&gt; r          0.693147180559945</span></span>
<span><span class="co">#&gt; r_sd                       0</span></span>
<span><span class="co">#&gt; K_sd                       0</span></span>
<span><span class="co">#&gt; growth              gompertz</span></span>
<span><span class="co">#&gt; A                          -</span></span>
<span><span class="co">#&gt; dens_dep                 K2N</span></span>
<span><span class="co">#&gt; border             absorbing</span></span>
<span><span class="co">#&gt; max_dist                2000</span></span>
<span><span class="co">#&gt; kernel_fun              rexp</span></span>
<span><span class="co">#&gt; dlist                   TRUE</span></span></code></pre></div>
<p>After information about input maps we can see a list of parameters
available to change. We will alter the following ones:</p>
<ul>
<li><p><code>r</code> - intrinsic growth rate,</p></li>
<li><p><code>r_sd</code> - intrinsic growth rate stochasticity,</p></li>
<li><p><code>K_sd</code> - environmental stochasticity,</p></li>
<li><p><code>growth</code> - growth function of virtual
species,</p></li>
<li><p><code>A</code> - strength of Allee effect,</p></li>
<li><p><code>dens_dep</code> - what determines the possibility of
settling in particular cell,</p></li>
<li><p><code>border</code> - how borders are treated.</p></li>
</ul>
<p>To change these parameters (along with carrying capacity map prepared
in the previous section) we could simply initialise new
<code>sim_data</code> object from scratch. Here we will use
<code><a href="https://rdrr.io/pkg/terra/man/update.html" class="external-link">update()</a></code> on <code>sim_data</code> from the previous example
to showcase its use.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_data_02</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">sim_data_01</span>,</span>
<span>  n1_map <span class="op">=</span> <span class="va">K_small</span>,</span>
<span>  K_map <span class="op">=</span> <span class="va">K_small_changing_interpolated</span>,</span>
<span>  K_sd <span class="op">=</span> <span class="fl">1.1</span>,</span>
<span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  r_sd <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  growth <span class="op">=</span> <span class="st">"ricker"</span>,</span>
<span>  A <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  dens_dep <span class="op">=</span> <span class="st">"K"</span>,</span>
<span>  border <span class="op">=</span> <span class="st">"reprising"</span>,</span>
<span>  rate <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The growth of virtual species is now defined using the ricker
(<code>growth = "ricker"</code>) function with increased intrinsic
growth rate (<code>r</code> <code>=</code> <code>log(5)</code>) combined
with weak Allee effect (<code>A = 0.2</code>) and added demographic
stochasticity (<code>r_sd = 0.05</code>). The probability of settlement
in a target cell is determined solely by its carrying capacity value
(<code>dens_dep = "K"</code>). We also changed the dispersal kernel’s
parameter (<code>rate = 1/500</code>) and the behaviour of the species
near the borders - now specimens cannot leave the specified study area
(<code>border = "reprising"</code>).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sim_data_02</span><span class="op">)</span></span>
<span><span class="co">#&gt; Class: sim_data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; n1_map:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;    0.00    0.00   56.00   44.84   72.00  100.00      12 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; K_map:</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 200  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       :    lyr.1,    lyr.2,    lyr.3,    lyr.4,    lyr.5,    lyr.6, ... </span></span>
<span><span class="co">#&gt; min values  :  0.00000,   0.0000,   0.0000,   0.0000,   0.0000,   0.0000, ... </span></span>
<span><span class="co">#&gt; max values  : 98.97829, 104.7768, 124.1069, 110.6544, 138.7362, 113.8916, ... </span></span>
<span><span class="co">#&gt;                           </span></span>
<span><span class="co">#&gt; resolution            1000</span></span>
<span><span class="co">#&gt; r          1.6094379124341</span></span>
<span><span class="co">#&gt; r_sd                  0.05</span></span>
<span><span class="co">#&gt; K_sd                   1.1</span></span>
<span><span class="co">#&gt; growth              ricker</span></span>
<span><span class="co">#&gt; A                      0.2</span></span>
<span><span class="co">#&gt; dens_dep                 K</span></span>
<span><span class="co">#&gt; border           reprising</span></span>
<span><span class="co">#&gt; max_dist              1000</span></span>
<span><span class="co">#&gt; kernel_fun            rexp</span></span>
<span><span class="co">#&gt; dlist                 TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulation-1">Simulation<a class="anchor" aria-label="anchor" href="#simulation-1"></a>
</h3>
<p>Simulation set-up will be very similar to the previous one. We
designed it that way in order to simplify the process of simulation
replication. We will also now demonstrate how parallel calculations can
be used when running simulations:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_result_02</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim.html">sim</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">sim_data_02</span>, time <span class="op">=</span> <span class="fl">200</span>, progress_bar <span class="op">=</span> <span class="cn">TRUE</span>, cl <span class="op">=</span> <span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim_result_02</span><span class="op">)</span></span></code></pre></div>
<p><img src="rangr_files/figure-html/summary_sim_result_02-1.png" width="70%" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; Summary of sim_results object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation summary: </span></span>
<span><span class="co">#&gt;                     </span></span>
<span><span class="co">#&gt; simulated time   200</span></span>
<span><span class="co">#&gt; extinction     FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Abundances summary: </span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span>
<span><span class="co">#&gt;    0.00    0.00   47.00   40.71   72.00  148.00    2400</span></span></code></pre>
<p>Now the behaviour of created virtual species and the world in which
it lives is much more complex than before. As a result, it can better
mimic real ecological scenarios that users might want to explore. In
this case, we observe a decline in the mean abundance in the first few
time steps of the simulation due to a change in parameters from the
previous simulation. Then, we see a rapidly increasing trend to catch up
to increasing carrying capacity, which slightly slows down later.</p>
</div>
<div class="section level3">
<h3 id="visualisation-1">Visualisation<a class="anchor" aria-label="anchor" href="#visualisation-1"></a>
</h3>
<p>Let’s visualise the result of this simulation.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_result_02</span>,</span>
<span>  time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sim_result_02</span><span class="op">$</span><span class="va">N_map</span> <span class="op">+</span> <span class="fl">5</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  template <span class="op">=</span> <span class="va">sim_data_02</span><span class="op">$</span><span class="va">K_map</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rangr_files/figure-html/unnamed-chunk-8-1.png" alt="Abundances" width="90%"><p class="caption">
Abundances
</p>
</div>
<pre><code><span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 15, 10, 12  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1000, 1000  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 270000, 280000, 610000, 625000  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : ETRS89 / Poland CS92 </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       : t_1, t_10, t_20, t_40, t_60, t_80, ... </span></span>
<span><span class="co">#&gt; min values  :   0,    0,    0,    0,    0,    0, ... </span></span>
<span><span class="co">#&gt; max values  : 100,   72,   75,   78,  107,  114, ...</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Katarzyna Markowska, Lechosław Kuczyński.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
