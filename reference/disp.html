<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The function simulates dispersal, for every square calculating the no. of
individuals that disperse out of this square and the no. of individuals that
disperse into this square."><title>Simulating dispersal — disp • rangr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulating dispersal — disp"><meta property="og:description" content="The function simulates dispersal, for every square calculating the no. of
individuals that disperse out of this square and the no. of individuals that
disperse into this square."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rangr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/rangr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/popecol/rangr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulating dispersal</h1>
      <small class="dont-index">Source: <a href="https://github.com/popecol/rangr/blob/HEAD/R/disp.R" class="external-link"><code>R/disp.R</code></a></small>
      <div class="d-none name"><code>disp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function simulates dispersal, for every square calculating the no. of
individuals that disperse out of this square and the no. of individuals that
disperse into this square.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">disp</span><span class="op">(</span></span>
<span>  <span class="va">N_t</span>,</span>
<span>  <span class="va">id</span>,</span>
<span>  <span class="va">data_table</span>,</span>
<span>  <span class="va">kernel</span>,</span>
<span>  <span class="va">dens_dep</span>,</span>
<span>  <span class="va">dlist</span>,</span>
<span>  <span class="va">id_within</span>,</span>
<span>  <span class="va">within_mask</span>,</span>
<span>  <span class="va">border</span>,</span>
<span>  <span class="va">max_dist</span>,</span>
<span>  <span class="va">resolution</span>,</span>
<span>  <span class="va">ncells_in_circle</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>N_t</dt>
<dd><p>integer matrix of population numbers at a single time step;
NA stands for cells that are outside the study area</p></dd>


<dt>id</dt>
<dd><p><code>RasterLayer </code> object
(of the same size as <code>N_t</code>) with cell identifiers</p></dd>


<dt>data_table</dt>
<dd><p>matrix that contains information about all cells
in current time points</p></dd>


<dt>kernel</dt>
<dd><p>a function defining dispersal kernel</p></dd>


<dt>dens_dep</dt>
<dd><p>character vector of length 1 specifying if the probability
of settling in a target square is (case-sensitive):</p><ul><li><p>"none" - fully random,</p></li>
<li><p>"K" - proportional to the carrying capacity of a target square,</p></li>
<li><p>"K2N" - density-dependent, i.e. proportional to the ratio of
carrying capacity of a target square to the number of individuals
already present in a target square</p></li>
</ul></dd>


<dt>dlist</dt>
<dd><p>a list with identifiers of target cells at a specified
distance from a focal cell</p></dd>


<dt>id_within</dt>
<dd><p>integer vector with identifiers of cells inside the
study area</p></dd>


<dt>within_mask</dt>
<dd><p>logical matrix that specifies boundaries of the study area</p></dd>


<dt>border</dt>
<dd><p>character vector of length 1 defining how to deal
with borders (case-sensitive):</p><ul><li><p>"absorbing" - individuals that disperse outside the study area
are removed from the population</p></li>
<li><p>"reprising" - cells outside the study area are not allowed
as targets for dispersal</p></li>
</ul></dd>


<dt>max_dist</dt>
<dd><p>a distance (in the same units as used in the raster <code>id</code>)
specifying the maximum range at which identifiers of target dispersal cells
are determined in advance (see <code><a href="initialise.html">initialise</a></code>)</p></dd>


<dt>resolution</dt>
<dd><p>integer vector of length 1; spatial resolution of
<code>id</code> raster</p></dd>


<dt>ncells_in_circle</dt>
<dd><p>numeric vector; number of cells on each distance</p></dd>


<dt>cl</dt>
<dd><p>if simulation is done in parallel, the name of a cluster object
created by <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The function returns a list that contains two matrices:</p>


<p><code>em</code> - emigration matrix with the number of individuals that dispersed
from each cell
<code>im</code> - immigration matrix with the number of individuals that dispersed
to each cell</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This is the function used by <code><a href="sim.html">sim</a></code> internally and is not intended to be
called by the user. The parameters for this function are passed from
a <code>sim_data</code> object created by <code><a href="initialise.html">initialise</a></code>.</p>
<p>Dispersal distance is expressed in original spatial units of the
<code><a href="https://rdrr.io/pkg/terra/man/SpatRaster-class.html" class="external-link">SpatRaster</a></code> provided to <code><a href="sim.html">sim</a></code> function
(<code>n1_map</code> and <code>K_map</code>), however, it is internally converted to units
of the simulation (i.e. to the size of a single cell) by calculating
<code>round(distance/resolution)</code>. Thus, if the selected dispersal distance is
smaller than <code>resolution/2</code>, it effectively means that an individual
does not disperse, i.e. it lands in the same cell as it was before.
The dispersal rate (proportion of dispersing individuals) can be estimated
from the dispersal kernel probability function by calculating the probability
that the dispersal distance is greater than <code>resolution/2</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># data preparation</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> terra 1.7.39</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">n1_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input_maps/n1_small.tif"</span>, package <span class="op">=</span> <span class="st">"rangr"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">K_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input_maps/K_small.tif"</span>, package <span class="op">=</span> <span class="st">"rangr"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="initialise.html">initialise</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  n1_map <span class="op">=</span> <span class="va">n1_small</span>,</span></span>
<span class="r-in"><span>  K_map <span class="op">=</span> <span class="va">K_small</span>,</span></span>
<span class="r-in"><span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  rate <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">1e3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> NaN values were found in input maps and replaced with NA (cells outside the study area)</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>sf required for evolution_status==2L</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># disp</span></span></span>
<span class="r-in"><span><span class="va">disp_output</span> <span class="op">&lt;-</span> <span class="fu">disp</span><span class="op">(</span></span></span>
<span class="r-in"><span>  N_t <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">n1_map</span>,</span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  data_table <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">data_table</span>,</span></span>
<span class="r-in"><span>  kernel <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">kernel</span>,</span></span>
<span class="r-in"><span>  dens_dep <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">dens_dep</span>,</span></span>
<span class="r-in"><span>  dlist <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">dlist</span>,</span></span>
<span class="r-in"><span>  id_within <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">id_within</span>,</span></span>
<span class="r-in"><span>  within_mask <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">within_mask</span>,</span></span>
<span class="r-in"><span>  border <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">border</span>,</span></span>
<span class="r-in"><span>  max_dist <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">max_dist</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">resolution</span>,</span></span>
<span class="r-in"><span>  ncells_in_circle <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">ncells_in_circle</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># immigration and emigration matrices</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">disp_output</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "em" "im"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Katarzyna Markowska, Lechosław Kuczyński.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

