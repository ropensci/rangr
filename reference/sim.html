<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mechanistic Metapopulation Simulator — sim • rangr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Mechanistic Metapopulation Simulator — sim"><meta property="og:description" content="This function simulates population growth and dispersal providing a given
environmental scenario. All parameters for the simulation must be set
in advance using initialise."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rangr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/rangr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ropensci/rangr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Mechanistic Metapopulation Simulator</h1>
    <small class="dont-index">Source: <a href="https://github.com/ropensci/rangr/blob/HEAD/R/sim.R" class="external-link"><code>R/sim.R</code></a></small>
    <div class="hidden name"><code>sim.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function simulates population growth and dispersal providing a given
environmental scenario. All parameters for the simulation must be set
in advance using <code><a href="initialise.html">initialise</a></code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sim</span><span class="op">(</span></span>
<span>  <span class="va">obj</span>,</span>
<span>  <span class="va">time</span>,</span>
<span>  burn <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  progress_bar <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>obj</dt>
<dd><p><code>sim_data</code> object created by <code><a href="initialise.html">initialise</a></code> containing all
simulation parameters and necessary data</p></dd>


<dt>time</dt>
<dd><p>positive integer vector of length 1; number of time steps
simulated</p></dd>


<dt>burn</dt>
<dd><p>positive integer vector of length 1; the number of burn-in time
steps that are
discarded from the output</p></dd>


<dt>cl</dt>
<dd><p>an optional cluster object created by
<code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></code> needed for parallel calculations</p></dd>


<dt>progress_bar</dt>
<dd><p>logical vector of length 1 determines if progress bar
for simulation
should be displayed</p></dd>


<dt>quiet</dt>
<dd><p>logical vector of length 1; determines if warnings should
be displayed</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>This function returns an object of class <code>sim_results</code> which is
a list containing the following components:</p><ul><li><p><code>extinction</code> - <code>TRUE</code> if population is extinct or <code>FALSE</code> otherwise</p></li>
<li><p><code>simulated_time</code> - number of simulated time steps without
the burn-in ones</p></li>
<li><p><code>N_map</code> - 3-dimensional array representing spatio-temporal
variability in population numbers. The first two dimensions correspond to
the spatial aspect of the output and the third dimension represents time.</p></li>
</ul><p>In case of a total extinction, a simulation is stopped before reaching
the specified no. of time steps. If the population died out before reaching
the <code>burn</code> threshold, then nothing can be returned and an error occurs.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This is the main simulation module. It takes the <code>sim_data</code> object prepared
by <code><a href="initialise.html">initialise</a></code> and runs simulation for a given number of time steps.
The initial (specified by the <code>burn</code> parameter) time steps are skipped
and discarded from the output. Computations can be done in parallel if
the name of a cluster created by <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></code>
is provided.</p>
<p>Generally, at each time step, simulation consists of two phases: local
dynamics and dispersal.</p>
<p>Local dynamics (which connects habitat patches in time) is defined by
the function <code><a href="growth.html">growth</a></code>. This parameter is specified while creating
the <code>obj</code> using <code><a href="initialise.html">initialise</a></code>, but can be later modified by using
the <code><a href="https://rdrr.io/pkg/terra/man/update.html" class="external-link">update</a></code> function. Population growth can be either exponential
or density-dependent, and the regulation is implemented by the use of
Gompertz or Ricker models (with a possibility of providing any other,
user defined function). For every cell, the expected population density
during the next time step is calculated from the corresponding number
of individuals currently present in this cell, and the actual number
of individuals is set by drawing a random number from the Poisson
distribution using this expected value. This procedure introduces a realistic
randomness, however additional levels of random variability can be
incorporated by providing parameters of both demographic and environmental
stochasticity while specifying the <code>sim_data</code> object using the <code><a href="initialise.html">initialise</a></code>
function (parameters <code>r_sd</code> and <code>K_sd</code>, respectively).</p>
<p>To simulate dispersal (which connects habitat patches in space), for each
individual in a given cell, a dispersal distance is randomly drawn from
the dispersal kernel density function. Then, each individual is translocated
to a randomly chosen cell at this distance apart from the current location.
For more details, see the <code><a href="disp.html">disp</a></code> function.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># data preparation</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">n1_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input_maps/n1_small.tif"</span>, package <span class="op">=</span> <span class="st">"rangr"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">K_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input_maps/K_small.tif"</span>, package <span class="op">=</span> <span class="st">"rangr"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="initialise.html">initialise</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  n1_map <span class="op">=</span> <span class="va">n1_small</span>,</span></span>
<span class="r-in"><span>  K_map <span class="op">=</span> <span class="va">K_small</span>,</span></span>
<span class="r-in"><span>  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  rate <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">1e3</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulation</span></span></span>
<span class="r-in"><span><span class="va">sim_1</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>obj <span class="op">=</span> <span class="va">sim_data</span>, time <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simulation with burned time steps and progress bar</span></span></span>
<span class="r-in"><span><span class="va">sim_2</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>obj <span class="op">=</span> <span class="va">sim_data</span>, time <span class="op">=</span> <span class="fl">100</span>, burn <span class="op">=</span> <span class="fl">20</span>, progress_bar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># example with parallelization</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># parallelized simulation</span></span></span>
<span class="r-in"><span><span class="va">sim_3</span> <span class="op">&lt;-</span> <span class="fu">sim</span><span class="op">(</span>obj <span class="op">=</span> <span class="va">sim_data</span>, time <span class="op">=</span> <span class="fl">100</span>, cl <span class="op">=</span> <span class="va">cl</span>, progress_bar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># visualisation</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">n1_small</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="to_rast.html">to_rast</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">sim_1</span>,</span></span>
<span class="r-in"><span>  time_points <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  template <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">K_map</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="to_rast.html">to_rast</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">sim_1</span>,</span></span>
<span class="r-in"><span>  time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  template <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">K_map</span></span></span>
<span class="r-in"><span><span class="op">)</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">sim_1</span><span class="op">$</span><span class="va">N_map</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Katarzyna Markowska, Lechosław Kuczyński.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

